# การแก้ไขปัญหาการจัดการวันที่เดโม่ในหน้า Admin

## ปัญหาที่พบ
- การจัดการวันที่เดโม่ในหน้า `/admin` ใช้งานไม่ได้
- ไม่มีข้อมูลแสดงในตาราง
- การนับจำนวนคนที่ลงทะเบียนไม่ถูกต้อง

## สาเหตุของปัญหา
1. **การจัดการ ObjectId ไม่สอดคล้องกัน** - ระหว่างการบันทึกและดึงข้อมูล
2. **การอัปเดต currentCount ไม่ถูกต้อง** - ไม่สอดคล้องกับการนับจริงจากตาราง registrations
3. **การแสดงผลข้อมูลผิดพลาด** - เนื่องจากข้อมูล currentCount ไม่ถูกต้อง

## การแก้ไขที่ทำ

### 1. แก้ไข API Endpoint `/api/demo-dates`
- เพิ่มการอัปเดต currentCount ในฐานข้อมูลให้สอดคล้องกับการนับจริง
- แก้ไขการจัดการ ObjectId ให้เป็น string อย่างสอดคล้อง

### 2. แก้ไขการลงทะเบียน (`/api/register`)
- ตรวจสอบจำนวนคนที่ลงทะเบียนจริงจากตาราง registrations
- อัปเดต currentCount ให้ถูกต้องหลังจากลงทะเบียน

### 3. แก้ไข API Endpoint `/api/public/demo-dates`
- คำนวณจำนวนคนที่ลงทะเบียนจริงจากตาราง registrations
- แสดงสถานะการใช้งานที่ถูกต้อง

### 4. เพิ่ม API Endpoint `/api/demo-dates/sync-counts`
- ฟังก์ชันสำหรับซิงค์จำนวนคนในวันที่เดโม่ทั้งหมด
- แก้ไขปัญหาข้อมูลไม่สอดคล้องกัน

### 5. ปรับปรุงหน้า Admin Dashboard
- เพิ่มปุ่ม "ซิงค์จำนวนคน" สำหรับแก้ไขปัญหาข้อมูล
- ปรับปรุงการแสดงผลข้อมูลให้ถูกต้อง
- เพิ่มการจัดการ error ที่ดีขึ้น

## วิธีการใช้งาน

### การซิงค์จำนวนคน
1. เข้าไปที่หน้า `/admin`
2. คลิกแท็บ "จัดการวันที่เดโม่"
3. คลิกปุ่ม "ซิงค์จำนวนคน" เพื่อแก้ไขข้อมูลที่ไม่สอดคล้องกัน

### การเพิ่มวันที่เดโม่
1. คลิกปุ่ม "เพิ่มวันที่เดโม่"
2. กรอกข้อความวันที่ (เช่น "วันที่ 10 เวลา 11โมง")
3. กำหนดจำนวนคนสูงสุด
4. คลิก "บันทึก"

### การแก้ไขวันที่เดโม่
1. คลิกไอคอนแก้ไขในตาราง
2. แก้ไขข้อมูลที่ต้องการ
3. คลิก "บันทึก"

## การทดสอบ
1. เพิ่มวันที่เดโม่ใหม่
2. ลงทะเบียนผู้ใช้หลายคนในวันที่เดโม่เดียวกัน
3. ตรวจสอบว่าจำนวนคนแสดงถูกต้อง
4. ทดสอบการซิงค์จำนวนคน

## หมายเหตุ
- ระบบจะนับจำนวนคนที่ลงทะเบียนจริงจากตาราง registrations
- การอัปเดต currentCount จะทำอัตโนมัติเมื่อโหลดข้อมูล
- หากพบปัญหาข้อมูลไม่สอดคล้องกัน ให้ใช้ปุ่ม "ซิงค์จำนวนคน"
